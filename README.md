# scc-notifications-msteams
Security Command Center Notifications to MSTeams when PubSub received 

## Deploy to Cloud Run Function

```bash
git clone https://github.com/nuttea/scc-notifications-msteams.git
cd scc-notifications-msteams

export MSTEAMS_WEBHOOK="https://xxxxx.webhook.office.com/webhookb2/7e3ddf36-b....."

gcloud functions deploy scc-notifications-msteams \
  --gen2 \
  --runtime=python310 \
  --region=asia-southeast1 \
  --source=. \
  --entry-point=msteams_alert \
  --set-env-vars=MSTEAMS_WEBHOOK=$MSTEAMS_WEBHOOK \
  --trigger-topic=scc-critical-and-high-severity-findings-topic
```

## Example notification event message

```json
{
   "notificationConfigName":"organizations/985348284259/locations/global/notificationConfigs/scc-critical-high-severity",
   "finding":{
      "name":"organizations/985348284259/sources/18332878859740010799/locations/global/findings/a871292c4e442cbb421e806c4fc1e393",
      "canonicalName":"projects/389071638346/sources/18332878859740010799/locations/global/findings/a871292c4e442cbb421e806c4fc1e393",
      "parent":"organizations/985348284259/sources/18332878859740010799/locations/global",
      "resourceName":"//storage.googleapis.com/nuttee-lab-00-dag-input-files",
      "state":"ACTIVE",
      "category":"PUBLIC_BUCKET_ACL",
      "externalUri":"https://console.cloud.google.com/storage/browser/nuttee-lab-00-dag-input-files;tab=permissions",
      "sourceProperties":{
         "Recommendation":"Go to https://console.cloud.google.com/storage/browser/nuttee-lab-00-dag-input-files;tab=permissions and remove \"allUsers\" and \"allAuthenticatedUsers\" from the bucket\\'s members.",
         "ExceptionInstructions":"Add the security mark \"allow_public_bucket_acl\" to the asset with a value of \"true\" to prevent this finding from being activated again.",
         "Explanation":"This bucket is public and can be accessed by anyone on the Internet. \"allUsers\" represents anyone on the Internet, and \"allAuthenticatedUsers\" represents anyone who is authenticated with a Google account; neither is constrained to users within your organization.",
         "ScannerName":"STORAGE_SCANNER",
         "ResourcePath":[
            "projects/nuttee-lab-00/",
            "folders/743695564634/",
            "folders/553722597015/",
            "organizations/985348284259/"
         ],
         "HasAdminRoles":false,
         "HasEditRoles":false,
         "gcloud_remediation":[
            "gsutil iam ch -d allUsers gs://nuttee-lab-00-dag-input-files",
            "gsutil iam ch -d allAuthenticatedUsers gs://nuttee-lab-00-dag-input-files"
         ],
         "cli_remediation":[
            "gsutil iam ch -d allUsers gs://nuttee-lab-00-dag-input-files",
            "gsutil iam ch -d allAuthenticatedUsers gs://nuttee-lab-00-dag-input-files"
         ],
         "compliance_standards":{
            "iso":[
               {
                  "ids":[
                     "A.14.1.3",
                     "A.8.2.3"
                  ]
               },
               {
                  "version":"2022",
                  "ids":[
                     "A.5.10",
                     "A.5.15",
                     "A.8.3",
                     "A.8.4"
                  ]
               }
            ],
            "hipaa":[
               {
                  "ids":[
                     "164.308(a)(3)(i)",
                     "164.308(a)(3)(ii)",
                     "164.312(a)(1)"
                  ]
               }
            ],
            "pci":[
               {
                  "ids":[
                     "7.1"
                  ]
               },
               {
                  "version":"4.0",
                  "ids":[
                     "1.3.1"
                  ]
               }
            ],
            "cis":[
               {
                  "version":"1.0",
                  "ids":[
                     "5.1"
                  ]
               },
               {
                  "version":"1.1",
                  "ids":[
                     "5.1"
                  ]
               },
               {
                  "version":"1.2",
                  "ids":[
                     "5.1"
                  ]
               },
               {
                  "version":"1.3",
                  "ids":[
                     "5.1"
                  ]
               },
               {
                  "version":"2.0",
                  "ids":[
                     "5.1"
                  ]
               }
            ],
            "ccm":[
               {
                  "version":"4",
                  "ids":[
                     "DSP-17"
                  ]
               }
            ],
            "cisControls":[
               {
                  "version":"8.0",
                  "ids":[
                     "3.3"
                  ]
               }
            ],
            "nistCsf":[
               {
                  "version":"1.0",
                  "ids":[
                     "PR-AC-4"
                  ]
               }
            ],
            "soc2":[
               {
                  "version":"2017",
                  "ids":[
                     "CC5.2.3",
                     "CC6.1.3",
                     "CC6.1.7"
                  ]
               }
            ],
            "nist":[
               {
                  "ids":[
                     "AC-2"
                  ]
               },
               {
                  "version":"r5",
                  "ids":[
                     "AC-3",
                     "AC-5",
                     "AC-6",
                     "MP-2"
                  ]
               }
            ]
         },
         "ReactivationCount":1.0
      },
      "securityMarks":{
         "name":"organizations/985348284259/sources/18332878859740010799/locations/global/findings/a871292c4e442cbb421e806c4fc1e393/securityMarks"
      },
      "eventTime":"2024-11-28T08:34:18.921718Z",
      "createTime":"2024-11-28T08:26:25.177Z",
      "severity":"HIGH",
      "mute":"UNDEFINED",
      "findingClass":"MISCONFIGURATION",
      "muteUpdateTime":"1970-01-01T00:00:00Z",
      "contacts":{
         "security":{
            "contacts":[
               {
                  "email":"nuttee@google.com"
               }
            ]
         },
         "technical":{
            "contacts":[
               {
                  "email":"nuttee@google.com"
               }
            ]
         }
      },
      "compliances":[
         {
            "standard":"cis",
            "version":"1.0",
            "ids":[
               "5.1"
            ]
         },
         {
            "standard":"cis",
            "version":"1.1",
            "ids":[
               "5.1"
            ]
         },
         {
            "standard":"cis",
            "version":"1.2",
            "ids":[
               "5.1"
            ]
         },
         {
            "standard":"cis",
            "version":"1.3",
            "ids":[
               "5.1"
            ]
         },
         {
            "standard":"cis",
            "version":"2.0",
            "ids":[
               "5.1"
            ]
         },
         {
            "standard":"nist",
            "ids":[
               "AC-2"
            ]
         },
         {
            "standard":"nist800-53",
            "version":"r5",
            "ids":[
               "AC-3",
               "AC-5",
               "AC-6",
               "MP-2"
            ]
         },
         {
            "standard":"pci",
            "ids":[
               "7.1"
            ]
         },
         {
            "standard":"pci-dss",
            "version":"4.0",
            "ids":[
               "1.3.1"
            ]
         },
         {
            "standard":"iso",
            "ids":[
               "A.14.1.3",
               "A.8.2.3"
            ]
         },
         {
            "standard":"iso-27001",
            "version":"2022",
            "ids":[
               "A.5.10",
               "A.5.15",
               "A.8.3",
               "A.8.4"
            ]
         },
         {
            "standard":"ccm",
            "version":"4",
            "ids":[
               "DSP-17"
            ]
         },
         {
            "standard":"nist-csf",
            "version":"1.0",
            "ids":[
               "PR-AC-4"
            ]
         },
         {
            "standard":"soc2",
            "version":"2017",
            "ids":[
               "CC5.2.3",
               "CC6.1.3",
               "CC6.1.7"
            ]
         },
         {
            "standard":"hipaa",
            "ids":[
               "164.308(a)(3)(i)",
               "164.308(a)(3)(ii)",
               "164.312(a)(1)"
            ]
         },
         {
            "standard":"cis-controls",
            "version":"8.0",
            "ids":[
               "3.3"
            ]
         }
      ],
      "parentDisplayName":"Security Health Analytics",
      "description":"This bucket is public and can be accessed by anyone on the Internet. \"allUsers\" represents anyone on the Internet, and \"allAuthenticatedUsers\" represents anyone who is authenticated with a Google account; neither is constrained to users within your organization.",
      "muteInfo":{
         "staticMute":{
            "state":"UNDEFINED",
            "applyTime":"1970-01-01T00:00:00Z"
         }
      }
   },
   "resource":{
      "name":"//storage.googleapis.com/nuttee-lab-00-dag-input-files",
      "displayName":"nuttee-lab-00-dag-input-files",
      "type":"google.cloud.storage.Bucket",
      "cloudProvider":"GOOGLE_CLOUD_PLATFORM",
      "service":"storage.googleapis.com",
      "location":"asia-southeast1",
      "gcpMetadata":{
         "project":"//cloudresourcemanager.googleapis.com/projects/389071638346",
         "projectDisplayName":"nuttee-lab-00",
         "parent":"//cloudresourcemanager.googleapis.com/projects/389071638346",
         "parentDisplayName":"nuttee-lab-00",
         "folders":[
            {
               "resourceFolder":"//cloudresourcemanager.googleapis.com/folders/743695564634",
               "resourceFolderDisplayName":"Production"
            },
            {
               "resourceFolder":"//cloudresourcemanager.googleapis.com/folders/553722597015",
               "resourceFolderDisplayName":"nuttee-company"
            }
         ],
         "organization":"organizations/985348284259"
      },
      "resourcePath":{
         "nodes":[
            {
               "nodeType":"GCP_PROJECT",
               "id":"projects/389071638346",
               "displayName":"nuttee-lab-00"
            },
            {
               "nodeType":"GCP_FOLDER",
               "id":"folders/743695564634",
               "displayName":"Production"
            },
            {
               "nodeType":"GCP_FOLDER",
               "id":"folders/553722597015",
               "displayName":"nuttee-company"
            },
            {
               "nodeType":"GCP_ORGANIZATION",
               "id":"organizations/985348284259"
            }
         ]
      },
      "resourcePathString":"organizations/985348284259/folders/553722597015/folders/743695564634/projects/389071638346"
   }
}
```